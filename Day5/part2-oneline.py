print(next(sum(sum(c >= 2 for c in r) for r in g) for p in [[tuple([int(z) for y in line.strip().split(' -> ') for z in y.split(',')]) for line in open('input.txt').readlines()]] for h,w in [(max(max(l[0],l[2]) for l in p),max(max(l[1],l[3]) for l in p))] for g in [[[0]*(w+1) for _ in range(h+1)]] for _ in [[[g[y].insert(x,n+1) for (s,t),(u,v) in [(min((a,b),(c,d)),max((a,b),(c,d)))] for x in range(s,u+1) for y in [t+(x-s)*(v-t)//(u-s)] for n in [g[y].pop(x)]] if abs(a-c) > abs(b-d) else [g[y].insert(x,n+1) for (t,s),(v,u) in [(min((b,a),(d,c)),max((b,a),(d,c)))] for y in range(t,v+1) for x in [s+(y-t)*(u-s)//(v-t)] for n in [g[y].pop(x)]] for a,b,c,d in p]]))
