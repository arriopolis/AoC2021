print(next(sum((xmax - xmin) * (ymax - ymin) * (zmax - zmin) for (xmin,xmax),(ymin,ymax),(zmin,zmax) in cubelets) for instrs in [[(b == 'on', tuple(map(lambda x : tuple([[int(xmin),int(xmax)+1] for xmin,xmax in [x[2:].split('..')]][0]), coords.split(',')))) for line in open('input.txt') for b,coords in [line.strip().split()]]] for cubelets in [set()] for _ in [[(cubelets.add(cube2) if xmin1 >= xmax2 or xmin2 >= xmax1 or ymin1 >= ymax2 or ymin2 >= ymax1 or zmin1 >= zmax2 or zmin2 >= zmax1 else next(cubelets.update(cubelets2.difference(cubelets1)) for all_xs, all_ys, all_zs in [(sorted(set([xmin1,xmax1,xmin2,xmax2])),sorted(set([ymin1,ymax1,ymin2,ymax2])),sorted(set([zmin1,zmax1,zmin2,zmax2])))] for xs1,xs2,ys1,ys2,zs1,zs2 in [(all_xs[all_xs.index(xmin1):all_xs.index(xmax1)+1], all_xs[all_xs.index(xmin2):all_xs.index(xmax2)+1], all_ys[all_ys.index(ymin1):all_ys.index(ymax1)+1], all_ys[all_ys.index(ymin2):all_ys.index(ymax2)+1], all_zs[all_zs.index(zmin1):all_zs.index(zmax1)+1], all_zs[all_zs.index(zmin2):all_zs.index(zmax2)+1])] for cubelets1 in [set(((x1,x2),(y1,y2),(z1,z2)) for x1,x2 in zip(xs1[:-1],xs1[1:]) for y1,y2 in zip(ys1[:-1],ys1[1:]) for z1,z2 in zip(zs1[:-1],zs1[1:]))] for cubelets2 in [set(((x1,x2),(y1,y2),(z1,z2)) for x1,x2 in zip(xs2[:-1],xs2[1:]) for y1,y2 in zip(ys2[:-1],ys2[1:]) for z1,z2 in zip(zs2[:-1],zs2[1:]))])) for b,cube1 in instrs for (xmin1,xmax1),(ymin1,ymax1),(zmin1,zmax1) in [cube1] for cube2 in [set(cubelets),cubelets.clear(),cubelets.update(set([cube1] if b else []))][0] for (xmin2,xmax2),(ymin2,ymax2),(zmin2,zmax2) in [cube2]]]))
